# see https://github.com/pablode/USD/blob/v22.11-ci/.github/workflows/deploy-release.yml
# https://github.com/usd-wg/assets/pull/49
# https://github.com/usd-wg/assets/pull/48 
name: Build Linux

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

      
jobs:
  build:
    name: Build Linux
    runs-on: ubuntu-latest
    container:
      image: swift:latest
    steps:
      - name: Checkout This Repo
        uses: actions/checkout@v3
      ## TODO, heard a rumour that ubuntu-latest uses passwordless sudo
      ## May not be necessary
      - name: Install sudo 
        run: apt update && apt install sudo
      ## Ubuntu latest has much of what is needed. 
      ## https://github.com/actions/runner-images/blob/main/images/linux/Ubuntu2204-Readme.md
      # - name: Set up packages (Linux)
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y 
      - name: Clone Pixar USD
      ## https://github.com/actions/checkout#checkout-multiple-repos-side-by-side
        uses: actions/checkout@v3
        with:
          repository: PixarAnimationStudios/OpenUSD
          ## The branch, tag or SHA to checkout.
          # ref: 
          ## Relative path under $GITHUB_WORKSPACE (!!?) to place the repository
          # path: ""
      - name: Build USD (no python) add to env
        run: |
          python3 USD/build_scripts/build_usd.py
          python3 USD/build_scripts/build_usd.py --no-python $BUILD_DEST_DIR
          echo "USD_INSTALL_DIR=$PWD/INSTALL" >> $GITHUB_ENV
