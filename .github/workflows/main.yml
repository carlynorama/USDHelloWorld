# see https://github.com/pablode/USD/blob/v22.11-ci/.github/workflows/deploy-release.yml
# https://github.com/usd-wg/assets/pull/49
# https://github.com/usd-wg/assets/pull/48 
name: Build Linux

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
      
jobs:
  build:
    name: Build Linux
    runs-on: ubuntu-latest
    steps:
      - name: Checkout This Repo
        uses: actions/checkout@v3
      - name: Update apt-get 
        run: sudo apt-get update
      ## Ubuntu latest has much of what is needed. Here for convenience
      ## https://github.com/actions/runner-images/blob/main/images/linux/Ubuntu2204-Readme.md
      # - name: Set up packages (Linux)
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y 
      - name: Clone Pixar USD
      ## https://github.com/actions/checkout#checkout-multiple-repos-side-by-side
        uses: actions/checkout@v3
        with:
          repository: PixarAnimationStudios/OpenUSD
          ## The branch, tag or SHA to checkout.
          # ref: 
          ## Relative path __under $GITHUB_WORKSPACE __ to place the repository
          ## This appears to be a litteral. Cannot take $GITHUB_ENV variable.
          path: OpenUSD_REPO
      - name: Add Repo Loaction to GITHUB_ENV
        run: |
          echo "USD_REPO_DIR=$PWD/OpenUSD_REPO" >> $GITHUB_ENV
          echo "-----"
          pwd  
          ls
          echo $GITHUB_WORKSPACE
          echo $PATH
          echo $GITHUB_ENV
          echo .env
          echo "-----"
      - name: Build USD (no python) add to env
        run: |
          python3 $USD_REPO_DIR/build_scripts/build_usd.py --no-python --no-materialx OpenUSD_BUILD
          echo "USD_BUILD_DIR=$PWD/OpenUSD_BUILD" >> $GITHUB_ENV
          
      - name: Add OpenUSD Build to PATH
        shell: bash
        run: |
          echo $USD_BUILD_DIR >> $GITHUB_PATH
      - name: Did it work?
        run: |
          usdcat -h
